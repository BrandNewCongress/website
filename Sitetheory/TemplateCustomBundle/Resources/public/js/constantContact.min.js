// This is a custom version of Constant Contact's form JS because their version sucks
function main($){$.support.cors=!0;var _form=$('[data-id="embedded_signup:form"]');_form.submit(function(e){e.preventDefault();var i,j,payload=$(this).serialize(),payload_check=payload.split("&"),payload_check_hash={},redirect=!1,redirect_url="";for(i=0;i<payload_check.length;i++){var p=payload_check[i].split("=");0===p[0].lastIndexOf("list_",0)&&(p[0]="list"),payload_check_hash[p[0]]=p[1]}_form.find("."+msgErrClass).remove(),_form.find("."+errClass).removeClass(errClass),_form.find(".ctct-flagged").removeClass("ctct-flagged");var id,item,payload_clean=payload.split("&"),custom_data_to_clean={};for(i=0;i<payload_clean.length;i++)item=payload_clean[i].split("="),item[1]&&""!==item[1]||(item[0].match(/cf_text_value--[\w0-9\-\:\_]*/)?(id=item[0].split("--")[1],custom_data_to_clean[id]=!0):item[0].match(/cf_date_value_day--[\w0-9\-\:\_]*/)?(id=item[0].split("--")[1],custom_data_to_clean[id]||(custom_data_to_clean[id]={}),custom_data_to_clean[id].day=!0):item[0].match(/cf_date_value_month--[\w0-9\-\:\_]*/)?(id=item[0].split("--")[1],custom_data_to_clean[id]||(custom_data_to_clean[id]={}),custom_data_to_clean[id].month=!0):item[0].match(/cf_date_value_year--[\w0-9\-\:\_]*/)?(id=item[0].split("--")[1],custom_data_to_clean[id]||(custom_data_to_clean[id]={}),custom_data_to_clean[id].year=!0):delete payload_clean[i]);payload_clean=payload_clean.filter(function(n){return void 0!==n});for(i in custom_data_to_clean)for(j=0;j<payload_clean.length;j++)item=payload_clean[j],item&&(item=item.split("="),item[0].match(new RegExp(".*--"+i,"i"))&&(custom_data_to_clean[i]===!0?delete payload_clean[j]:"object"==typeof custom_data_to_clean[i]&&custom_data_to_clean[i].day===!0&&custom_data_to_clean[i].month===!0&&custom_data_to_clean[i].year===!0&&delete payload_clean[j]));var url_filtered_payload=$.grep(payload_clean.filter(function(n){return void 0!==n}),function(n,i){return"url"==n.substring(0,3)});if(url_filtered_payload.length>0){redirect=!0;for(i in url_filtered_payload){redirect_url=decodeURIComponent(url_filtered_payload[i].substring(4));break}payload_clean=payload_clean.filter(function(n){return"url"!==n.substring(0,3)})}return payload_clean=payload_clean.filter(function(n){return void 0!==n}).join("&"),$.ajax({type:"POST",crossDomain:!0,url:postURL,data:payload_clean,error:function(xhr,status,err){if(json=xhr.responseJSON,json)if(json.offenders)for(var i in json.offenders){var item=json.offenders[i],offender=item.offender,required=item.required,inputUI=_form.find("[name="+offender+"]"),labelUI=null,p=inputUI.parent("p");if(0===p.length){if(labelUI=_form.find("[data-name="+offender+"]"),"unsubscribed"===offender&&(labelUI=_form.find("[data-name=email]")),0===labelUI.length)continue}else labelUI=p.find("label");required!==!0||offender.match(/list.*/)?"ca"===offender?labelUI.hasClass("ctct-flagged")||labelUI.after(errorSection("ca")):"email"===offender||"unsubscribed"===offender?labelUI.hasClass("ctct-flagged")||("email"===offender?labelUI.after(errorSection("email")):labelUI.after(errorSection("unsubscribed"))):offender.match(/list.*/)?labelUI.hasClass("ctct-flagged")||labelUI.after(errorSection("list")):labelUI.hasClass("ctct-flagged")||labelUI.after(errorSection("generic")):labelUI.hasClass("ctct-flagged")||labelUI.after(errorSection("required")),inputUI.addClass(errClass),labelUI.addClass("ctct-flagged")}else _form.prepend(errorSection("shared"));else _form.prepend(errorSection("shared"))},success:function(data,status,xhr){redirect===!1?($(".ctct-embed-signup button").hide(),$(".ctct-embed-signup form").hide(),$(".success_message").removeClass("hide")):window.location.href=redirect_url}}),!1})}function errorSection(errorType){return'<div class="'+msgErrClass+'">'+localizedErrMap[errorType]+"</div>"}var errClass="is-error",msgErrClass="ctct-form-errorMessage",localizedErrMap={};localizedErrMap.required="This field is required.",localizedErrMap.ca="An unexpected error occurred while attempting to send email.",localizedErrMap.generic="This field is invalid.",localizedErrMap.shared="Sorry, we could not complete your sign-up. Please contact us to resolve this.",localizedErrMap.unsubscribed="Sorry, you were previously unsubscribed from our lists. Please contact us to subscribe again.";var postURL="https://visitor2.constantcontact.com/api/signup";if("undefined"==typeof $&&"undefined"==typeof jQuery){var jquery_lib=document.createElement("script");document.head.appendChild(jquery_lib),jquery_lib.onload=function(){var __$$=jQuery.noConflict(!0);main(__$$)},jquery_lib.src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"}else main(jQuery);