{% extends 'SitetheoryStreamBundle::Landing.html.twig' %}


{#
########
SETTINGS
########
#}

{# TEMPLATE SHELL ADJUSTMENTS - These will be the same for most home page streams #}

{% set headerFull = true %}

{% set sectionMenuActive = '' %}
{% set sectionMenuHardCoded = '' %}

{# Header image exists #}
{% set streamClass = 'landingStream' %}

{# Hide sidebar on desktop #}
{% set columnSidebar = 'hide-gt-sm' %}
{% set columnMain = '' %}

{# Hide gutter in main column #}
{% block mainColumnGutter %}
{% endblock mainColumnGutter %}

{# Remove standard header image #}
{% block headerImageInsideHeader %}
{% endblock headerImageInsideHeader %}

{# Hide page title #}
{% block pageTitle %}
{% endblock pageTitle %}

{# Remove shell vertical content padding class to replace with stream padding #}
{% set shellContentStructure = 'siteMaxWidth siteSidePadding' %}



{#
################
CSS & JAVASCRIPT
################
#}

{% block link %}
    {{ parent() }}
    {# TODO: once assetic is fixed to load local resources, change this to look like standard #}
    {# #
    {% stylesheets '@SitetheoryTemplateCustomBundle/Resources/public/css/site.css' filter='?uglifycss' filter='cssrewrite' %}
    <link rel="stylesheet" href="{{ asset_url }}" data-file="site.css">
    {% endstylesheets %}
    {# #}
    <link rel="stylesheet" href="{{ asset('bundles/sitetheorytemplatecustom/css/landing.css') }}">
{% endblock link %}

{% block script %}
    {{ parent() }}
    {# Code for Facebook Page Plugin: #FB-feedComponent #}
    <script id="facebook-jssdk" async="true" src="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8&appId=162487723815676"></script>

    {# IF we want to switch to Twitter. Hiding the FB widget below breaks the FB videos in the left column so that would need to be looked at when switching
    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
    #}

{% endblock script %}





{#
######
LAYOUT
######
#}

{% block body %}
    {# Code for Facebook Page Plugin: #FB-feedComponent (script manually added to head to try to delay it) #}
    <div id="fb-root"></div>

    {{ parent() }}

{% endblock body %}


{# NOTE: this page is a stream, but we are currently hard coding everything, so we shouldn't use the majority of the contentType block in the ListBase.html.twig. So instead we are currently just overwriting the entire ContentType block #}

{% block contentType %}

    {# Home Landing Layout #}
    <div class="clearfix">

        {#
        <a href="/candidates">
            <div id="announcementBanner" class="positionAnchor clearfix">
                <div id="newsLabel" class="salmon fontPrimary verticalCenter">News</div>
                <p id="announcement" class="fontBody textCenter">Weâ€™ve announced our first 24 candidate draftees. Help us convince them to run!<span hide-xs hide-sm class="learnMore smallLabel salmonText">Learn More</span></p>
                <div hide-xs hide-sm class="doubleArrow fontTertiary verticalCenter"> >> </div>
            </div>
        </a>
        #}

        <a id="slideshowLink" href="/nominate">
            <div id="homeSlides" class="positionAnchor salmon">

                <div class="slideshowImage">
                    <img data-plugin="Lazy" src="{{ asset('bundles/sitetheorytemplatecustom/images/homeImageMain/slideshowMap-xs.jpg') }}" alt="">
                </div>

                <div id="slidesContent" class="textCenter">
                    <div id="slideText1" class="fontPrimary starLeft">
                        <div class="starRight">Our Goal</div>
                    </div>
                    <p class="bodyLarge">Elect a Brand New Congress that works for all Americans.</p>
                    <div flex="nogrow" id="h4Container" layout="row">
                        <div flex class="borderDashedLight">&nbsp;</div>
                        <div flex-xs="100" flex-sm="60" flex-gt-md="none">
                            <h4 class="yellowText">We need to find the best people in every district in America. <span class="ctaHover">Nominate someone now.</span>
                            </h4>
                        </div>
                        <div flex class="borderDashedLight">&nbsp;</div>
                    </div>
                </div>


                {# Draftees Ad

                <div id="slidesContent">
                    <h4 class="fontTertiary">ANNOUNCING OUR FIRST CANDIDATE</h4>
                    <p class="fontSecondary">Draftees</p>
                    <div class="btn btnBig btnSalmon" href="/#homeJoin">Convince them to run</div>
                </div>
                #}
            </div>
        </a>

        <div id="homeJoin">
            <div class="shellVerticalPadding">
                <div class="backgroundDark">
                    <h1 class="textCenter">Add Your Name</h1>
                </div>

                {# Fancy Signup Form with Map #}
                <a name="homeJoin"></a>
                {# TEMPORARILY HIDE DYNAMIC NUMBER TILL API WORKS #}
                {#
                <div id="progressAndJoin" ng-controller="Api" options='{"url":"https://api.{{ environment.site.domainprimary }}", "controller":"/people/count", "onLoad": "fetch", "onTime": {"time": "10s", "method":"fetch"}}'>
                    <p class="intro textCenter divCenter"><strong><span ng-cloak="true">{% verbatim %}{{ results.count | number }}{% endverbatim %}</span><span ng-hide="results.count">213,367</span> people want to fix our broken system. Help us get to to 500,000.</strong></p>
                    <!-- hide as soon as angular loads -->
                    <div class="loader" ng-hide="true"></div>
                    <div layout="row" layout-wrap="" ng-cloak="">
                        <div flex="100" flex-gt-sm="33" flex-order="2" flex-order-gt-sm="1">
                            <div class="positionAnchor" id="signUpProgress">
                                <div class="positionAll" id="progressNumbers">
                                    <div class="positionLeftBottom smallLabel fontBody salmonText" id="startNumber">0</div>
                                    <div class="positionRightBottom smallLabel fontBody salmonText" id="endNumber">500K</div>
                                    <div id="numberLine"></div>
                                </div>
                                <div class="positionAll" id="progressBarContainer">
                                    <!-- this uses the dynamic countUp value and not the results.count directly (so that it animates) -->
                                    <div id="progressBar" class="positionLeftTop salmon" style="max-width: 100%" ng-style="{'width':(100*(countUp.frameVal/500000))+'%'}"></div>
                                </div>
                                {% embed '@SitetheoryTemplateCustomBundle/Resources/public/images/progressBarCover.svg' %}{% block id %}americaMap{% endblock %}{% endembed %}
                            </div>
                        </div>
                        <div flex="100" flex-gt-sm="33" flex-order="1" flex-order-gt-sm="2">
                            <div class="divCenter textCenter">
                                <div class="divCenter" id="signUpLabel">
                                    <div class="starLeft">
                                        <div class="starRight">
                                            <div class="starText fontPrimary salmonText">Right Now</div>
                                        </div>
                                    </div>
                                </div>
                                <div id="totalSignUp" class="borderDashed fontSecondary salmonText" count-up="" start-val="0" end-val="results.count" count-instance="countUp" duration="1.5" decimals="0" options="{easingFn: easingFn}" scroll-spy-event="elementFirstScrolledIntoView" scroll-spy=""></div>
                            </div>
                        </div>
                        <div flex="100" flex-gt-sm="33" flex-order="3">
                            <div class="joinForm pullRight" id="candidateJoin">
                                <p class="textCenter divCenter" hide-gt-sm=""><strong>Sign up and help us convince our new draftees to run!</strong></p>
                                <!-- Reuse Registration Form from shell -->
                                {{ block('registrationForm') }}
                            </div>
                        </div>
                    </div>
                </div>
                #}

                <div id="progressAndJoin">
                    <p class="intro textCenter divCenter"><strong>243,385 people want to fix our broken system. Help us get to 500,000.</strong></p>
                    <!-- hide as soon as angular loads -->
                    <div class="loader" ng-hide="true"></div>
                    <div layout="row" layout-wrap="" ng-cloak="">
                        <div flex="100" flex-gt-sm="33" flex-order="2" flex-order-gt-sm="1">
                            <div class="positionAnchor" id="signUpProgress">
                                <div class="positionAll" id="progressNumbers">
                                    <div class="positionLeftBottom smallLabel fontBody salmonText" id="startNumber">0</div>
                                    <div class="positionRightBottom smallLabel fontBody salmonText" id="endNumber">500K</div>
                                    <div id="numberLine"></div>
                                </div>
                                <div class="positionAll" id="progressBarContainer">
                                    <div id="progressBar" class="positionLeftTop salmon" style="max-width: 100%" ng-style="{'width':(100*(countUp.frameVal/500000))+'%'}"></div>
                                </div>
                                {% embed '@SitetheoryTemplateCustomBundle/Resources/public/images/progressBarCover.svg' %}{% block id %}americaMap{% endblock %}{% endembed %}
                            </div>
                        </div>
                        <div flex="100" flex-gt-sm="33" flex-order="1" flex-order-gt-sm="2">
                            <div class="divCenter textCenter">
                                <div class="divCenter" id="signUpLabel">
                                    <div class="starLeft">
                                        <div class="starRight">
                                            <div class="starText fontPrimary salmonText">Right Now</div>
                                        </div>
                                    </div>
                                </div>
                                <div id="totalSignUp" class="borderDashed fontSecondary salmonText" count-up="" start-val="0" end-val="243385" count-instance="countUp" duration="1.5" decimals="0" options="{easingFn: easingFn}" scroll-spy-event="elementFirstScrolledIntoView" scroll-spy=""></div>
                            </div>
                        </div>
                        <div flex="100" flex-gt-sm="33" flex-order="3">
                            <div class="joinForm pullRight" id="candidateJoin">
                                <p class="textCenter divCenter" hide-gt-sm=""><strong>Sign up and help us convince our new draftees to run!</strong></p>
                                <!-- Reuse Registration Form from shell -->
                                {{ block('registrationForm') }}
                            </div>
                        </div>
                    </div>
                </div>

                {# Basic Signup Form #}
                {#
                <div id="homeJoinForm" class="joinForm">
                    <p class="fontSecondary textCenter"><strong>Join us if you believe itâ€™s time to reset our democracy.</strong></p>
                    <div class="loader" ng-hide="true"></div>
                    {{ block('registrationForm') }}
                </div>
                #}
            </div>
        </div>

        <div class="borderDashedBold">
            <div id="welcome" class="divCenter textCenter shellVerticalPadding">
                <h4>Congress is</h4>
                <h1>Broken</h1>
                <div class="content bodyLarge fontSecondary" ng-model="model.data.version.text" {{ block('editableContentAttributes') }}>
                    {% autoescape false %}
                        {{ content.version.text }}
                    {% endautoescape %}
                </div>
            </div>
        </div>


        <div id="pressLogos" class="shellVerticalPadding">

            {# hide as soon as angular loads #}
            <div class="loader" ng-hide="true"></div>

            <div layout="row" layout-wrap>
                <div flex="100" flex-gt-md="50">
                    <div class="clearfix">
                        <div id="WaPO" class="pressLogo">
                            <a href="https://www.washingtonpost.com/opinions/the-sanders-movement-is-only-just-beginning/2016/08/09/228b8744-5d87-11e6-9d2f-b1a3564181a1_story.html?utm_term=.dd59cf8877af" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressWaPo.png') }}" alt="Washington Post">
                            </a>
                        </div>
                        <div id="WSJ" class="pressLogo">
                            <a href="http://www.wsj.com/articles/sanders-supporters-seek-to-make-his-liberal-agenda-endure-1462485056" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressWSJ.png') }}" alt="Wall Street Journal">
                            </a>
                        </div>
                        <div id="Wired" class="pressLogo">
                            <a href="https://www.wired.com/2016/05/bernie-wont-get-nomination-online-army-isnt-done/" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressWired.png') }}" alt="Wired">
                            </a>
                        </div>
                        <div id="HuffPo" class="pressLogo">
                            <a href="http://www.huffingtonpost.com/entry/bernie-sanders-congress_us_5720e608e4b0b49df6a9c933" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressHuffPo.png') }}" alt="The Huffington Post">
                            </a>
                        </div>
                        <div id="Beast" class="pressLogo">
                            <a href="http://www.thedailybeast.com/articles/2016/05/02/where-does-the-bernie-sanders-movement-go-from-here.html" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressBeast.png') }}" alt="The Daily Beast">
                            </a>
                        </div>
                        <div id="Slate" class="pressLogo">
                            <a href="http://www.slate.com/articles/news_and_politics/the_next_20/2016/09/ralph_nader_and_the_tragedy_of_voter_as_consumer_politics.html" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressSlate.png') }}" alt="Slate">
                            </a>
                        </div>
                    </div>
                </div>
                <div flex="100" flex-gt-md="50">
                    <div class="clearfix">
                        <div id="Nation" class="pressLogo">
                            <a href="https://www.thenation.com/article/is-brand-new-congress-the-future-of-progressive-politics/" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressTheNation.png') }}" alt="The Nation">
                            </a>
                        </div>
                        <div id="Frisky" class="pressLogo">
                            <a href="http://www.thefrisky.com/2016-06-17/bernie-sanders-supporters-launch-brand-new-congress-as-the-next-chapter-of-his-political-revolution/" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressTheFrisky.png') }}" alt="The Frisky">
                            </a>
                        </div>
                        <div id="Salon" class="pressLogo">
                            <a href="http://www.salon.com/2016/07/24/whats_next_for_the_bernie_sanders_revolution_meet_the_groups_keeping_up_his_fight_for_progressive_values/" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressSalon.png') }}" alt="Salon">
                            </a>
                        </div>
                        <div id="Bustle" class="pressLogo">
                            <a href="https://www.bustle.com/articles/167209-what-is-brand-new-congress-its-one-thing-bernie-sanders-supporters-can-do-next" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressBustle.png') }}" alt="Bustle">
                            </a>
                        </div>
                        <div id="Boing" class="pressLogo">
                            <a href="http://boingboing.net/2016/04/26/brand-new-congress-535-progre.html" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressBoingBoing.png') }}" alt="Boing Boing">
                            </a>
                        </div>
                        <div id="RollCall" class="pressLogo">
                            <a href="http://www.rollcall.com/news/politics/whats-next-sanders-backers-replace-entire-congress" target="_blank">
                                <img src="{{ asset('bundles/sitetheorytemplatecustom/images/pressRollCall.png') }}" alt="Roll Call">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sectionBorder backgroundDark"></div>

        <a name="homeCandidates"></a>
        <div id="homeCandidates" class="shellVerticalPadding textCenter">
            <h4>Candidate</h4>
            <h1>Draftees</h1>

            <p class="intro fontSecondary">Meet our first draftees! These are exceptional leaders that you nominated. They are public servants, entrepreneurs, local leaders, and national figures. If they are going to set aside their important work to run for congress, they need to know we have the momentum to get them there.</p>

            <div class="clearfix">
                <p class="bodyLarge">These draftees have not agreed to run yet. Help us convince them.</p>

                <div class="homeActionBtns">
                    <a class="btn" href="/#homeJoin">Sign Up</a>
                    <a class="btn" href="/Volunteer">Volunteer</a>
                </div>
            </div>


            <div class="clearfix candidateGrid">
                <div class="candidateColumn">

                    {# Candidate 1 #}
                    <div class="candidateContainer">
                        <div class="candidateImage positionAnchor">
                            <div class="imageGradientBottom"></div>
                            <a href="/Cori-Bush">
                                <div class="candidateInfo">
                                    <p class="name fontSecondary">Cori Bush</p>
                                    <p class="title fontTertiary">Pastor & Nurse</p>
                                    <div class="candidateBio fontBody">
                                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean consectetur enim ut justo accumsan fermentum. Morbi vitae posuere nisl.
                                    </div>
                                </div>
                                <div class="candidateImageCover positionAll"></div>
                                <img data-plugin="Lazy" src="{{ asset('bundles/sitetheorytemplatecustom/images/candidates/CoriBush-xs.jpg') }}" alt="">
                            </a>
                        </div>
                        <div class="borderDashed">
                            <div class="candidateDistrict fontPrimary starLeft divCenter">
                                <p class="starRight">
                                    Missouri 1st
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                {# Candidate 2 #}
                <div class="candidateColumn">
                    <div class="candidateContainer">
                        <div class="candidateImage positionAnchor">
                            <div class="imageGradientBottom"></div>
                            <a href="/Jamie-Moffett">
                                <div class="candidateInfo">
                                    <p class="name fontSecondary">Jamie Moffett</p>
                                    <p class="title fontTertiary">Documentary Filmmaker</p>
                                    <div class="candidateBio fontBody">
                                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean consectetur enim ut justo accumsan fermentum. Morbi vitae posuere nisl.
                                    </div>
                                </div>
                                <div class="candidateImageCover positionAll"></div>
                                <img data-plugin="Lazy" src="{{ asset('bundles/sitetheorytemplatecustom/images/candidates/JamieMoffett-xs.jpg') }}" alt="">
                            </a>
                        </div>
                        <div class="borderDashed">
                            <div class="candidateDistrict fontPrimary starLeft divCenter">
                                <p class="starRight">
                                    Pennsylvania 1st
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div hide-xs hide-sm class="candidateColumn">
                    <div class="candidateContainer tempCandidateAsk">
                        <a href="/nominate">
                            <div class="candidateImage positionAnchor purple">
                                <div class="candidateInfo">
                                    <p class="adText fontSecondary">Do you know a community leader that would make a great representative?</p>
                                    <div class="title fontTertiary starLeft">
                                        <p class="starRight">Nominate</p>
                                        <div class="animatedUnderline"></div>
                                    </div>
                                </div>
                                    <img src="{{ asset('bundles/sitetheorytemplatecustom/images/candidates/candidateAsk.jpg') }}" alt="">
                            </div>
                            <div class="borderDashed">
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="sectionBorder backgroundDark"></div>


        <div id="homeSpecifics" class="shellVerticalPadding textCenter">

            <h4>Ready to</h4>
            <h1>Do Something?</h1>

            <div id="homeImageLinks">
                <div class="clearfix">

                    <div class="stGrid column33">
                        <a  class="backgroundDark" href="/nominate">
                            <div class="imageWrapper">
                                <img data-plugin="Lazy" class="easyTransition" src="{{ asset('bundles/sitetheorytemplatecustom/images/homeImageModules/imageLinkNominate-xs.jpg') }}" alt="">
                            </div>
                        </a>
                    </div>

                    <div class="stGrid column33">
                        <a class="backgroundDark" href="https://secure.actblue.com/contribute/page/brandnewcongress" target="_blank">
                            <div class="imageWrapper">
                                <img data-plugin="Lazy" class="easyTransition" src="{{ asset('bundles/sitetheorytemplatecustom/images/homeImageModules/imageLinkDonate-xs.jpg') }}" alt="">
                            </div>
                        </a>
                    </div>

                    <div class="stGrid column33">
                        <a  class="backgroundDark" href="https://shop.brandnewcongress.org" target="_blank">
                            <div class="imageWrapper">
                                <img data-plugin="Lazy" class="easyTransition" src="{{ asset('bundles/sitetheorytemplatecustom/images/homeImageModules/imageLinkStore-xs.jpg') }}" alt="">
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="sectionBorder backgroundDark"></div>

        {# hide as soon as angular loads #}
        <div class="loader" ng-hide="true"></div>

        <div id="homeCurrent" class="shellVerticalPadding" ng-cloak ng-cloak-reveal>
            <div layout="row" layout-wrap>
                <div flex="100" flex-gt-xs="50">
                    <div id="currentMedia">
                        <h1>Watch</h1>
                        <div id="currentMediaContainer" class="borderDashedBold clearfix">
                            <div class="mediaItem">
                                <div class="mediaHeader">
                                    <div class="date pullRight">11.23.16</div>
                                    <h2 class="purpleText">On Rachel Maddow</h2>
                                </div>
                                <div id="videoMaddow" data-url="https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2Fbrandnewcongress%2Fvideos%2F844761672323970%2F&amp;show_text=0"></div>
                            </div>
                            <div class="mediaItem">
                                <div class="mediaHeader">
                                    <div class="date pullRight">11.23.16</div>
                                    <h2 class="purpleText">Now This</h2>
                                </div>
                                <div id="videoNowThis" data-url="https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2FNowThisElection%2Fvideos%2F1255138781184276%2F&amp;show_text=0"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="FB-feedParent" flex="100" flex-gt-xs="50">

                    <div id="currentSocial">

                        {#
                       <h1>Converse</h1>

                       <div id="twitterContainer" class="borderDashedBold clearfix">
                           <a class="twitter-timeline" data-width="580" data-height="800" data-link-color="#2B7BB9" href="https://twitter.com/BrandNew535">Tweets by BrandNew535</a>
                       </div>
                        #}

                       <h1>Comment</h1>
                       {# TODO: put this in a BNCCoreBundle so it can be reused easily #}
                        {# Script to fix the facebook resize issue #}
                        <script>
                            // Use Require.js or Contextual Scope
                            (function (root, factory) {
                                if (typeof require === 'function') {
                                    require(['stratus'], factory);
                                } else {
                                    factory(root.Stratus);
                                }
                            }(this, function (Stratus) {

                                Stratus.DOM.complete(function () {

                                    ////////////////////
                                    // Custom Variables
                                    ////////////////////
                                    var facebookPageName = 'Brand New Congress';
                                    var facebookPageId  = 'brandnewcongress';
                                    var containerId = 'facebookPageContainer';
                                    var relatedContainerId = 'currentMediaContainer';
                                    var relatedContainerOffset = -150;


                                    ////////////////
                                    // Setup
                                    ////////////////
                                    var container           = document.getElementById(containerId);
                                    var relatedContainer    = document.getElementById((relatedContainerId || containerId));
                                    var loadJob;

                                    ////////////////
                                    // Functions
                                    ////////////////
                                    function loadVideo(id) {
                                        var container = document.getElementById(id);
                                        if(!container) return false;
                                        var url = container.getAttribute('data-url');
                                        if(!url) return false;
                                        var content = '<div class="iframeVideoWrapper"><iframe width="550" height="300" src="'+url+'" frameborder="0" allowfullscreen=""></iframe></div>';
                                        container.innerHTML = content;
                                    }
                                    loadVideo('videoMaddow');
                                    loadVideo('videoNowThis');


                                    function resizePlugin() {
                                        // Manually resize Facebook Plugin's span and iframe to be 100%
                                        var plugin = document.querySelector('.fb-page')
                                        var containerSpan = plugin.querySelector('span');
                                        containerSpan.style.width="100%";
                                        var iframe = plugin.querySelector('iframe');
                                        iframe.width = "100%";
                                        iframe.style.width = "100%";
                                        // FB has max 500px, scale if it's bigger so it fits in space at least
                                        var maxWidth = 500;
                                        var width = container.offsetWidth;
                                        if(width > maxWidth) {
                                            var scale = width/maxWidth;
                                            iframe.style.transform = 'scale('+scale+')';
                                            iframe.style['transform-origin'] = '0 0';
                                        }
                                    };
                                    function loadPlugin() {
                                        // Get height of the related Container (e.g. in another column)
                                        var height          = relatedContainer.offsetHeight;
                                        height = height > 0 ? (height  + relatedContainerOffset) : height;
                                        var width           = container.offsetWidth;
                                        var minHeight       = 500;
                                        var minWidth        = 500;
                                        height = height < minHeight ? minHeight : height;
                                        width = width < minWidth ? minWidth : width;

                                        // Facebook Page Plugin Code
                                        var content = '<div class="fb-page" data-href="https://www.facebook.com/'+facebookPageId+'" data-tabs="timeline" data-width="'+width+'" data-height="'+height+'" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div><blockquote cite="https://www.facebook.com/'+facebookPageId+'" class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/'+facebookPageId+'">'+facebookPageName+'</a></blockquote>';

                                        // Empty Container
                                        while(container.firstChild){ container.removeChild(container.firstChild); }

                                        // Add Plugin
                                        container.innerHTML = content;

                                        // Parse Plugin
                                        FB.XFBML.parse();
                                    };

                                    // Register Resize after Plugin is Rendered
                                    FB.Event.subscribe('xfbml.render', function() {
                                        resizePlugin();
                                    });


                                    // (HACK): LoadPlugin does not resize height correctly on Load because it does not know the correct height so we delay it until the height is set
                                    loadJob = Stratus.Chronos.add(0.2, function() {
                                        // hard code a bit less than related contaier
                                        if(relatedContainer.offsetHeight > 0) {
                                            Stratus.Chronos.disable(loadJob);
                                            loadPlugin();
                                        }
                                    }, this);
                                    Stratus.Chronos.enable(loadJob);

                                    // Reload on Resize
                                    window.onresize = function() { loadPlugin(); };

                                    loadPlugin();

                                });
                            }));
                        </script>
                        <div id="facebookPageContainer" class="borderDashedBold clearfix"></div>

                    </div>
                </div>
            </div>
        </div>

    </div>


{% endblock contentType %}


